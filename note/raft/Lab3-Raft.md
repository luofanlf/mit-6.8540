# Lab3 - Raft

#### leader election

可视化leader选举（两个非常好的能让你理解raft的网站）：https://raft.github.io

http://thesecretlivesofdata.com/raft/

Raft 定义了三种角色：**领导者（Leader）**、**跟随者（Follower）** 和 **候选人（Candidate）**

1.   **初始状态和超时机制**：
   - 每个节点启动时，默认处于追随者（follower）状态。
   - 追随者设置一个随机**选举超时时间**，避免多个follower同时超时竞争leader（通常在 150-300ms 范围内）。
2. **转变为候选人（Candidate）**：
   - 如果一个追随者在选举超时时间内未收到领导者的心跳消息，就会认为当前没有领导者，于是转变为候选人。
   - 候选人自增当前任期号，并给自己投票，同时请求其他节点投票。
3. **请求投票（RequestVote RPC）**：
   - 候选人向集群中其他所有节点发送 `RequestVote` RPC 请求。
   - 其他节点收到请求后会进行处理，更新自己的任期，并根据情况决定是否投票，按照先来先得的原则（1.任期号检查：检查候选人的任期号term，如果任期号小于当前节点，拒绝投票，因为可能已经有更新更合法的leader存在。2.投票权检查：每个节点每个任期内只能投一票。3.日志一致性检查：candidate日志最后一个条目的任期号必须大于等于follower，并且如果相等的话该条目的索引需要大于等于follower）
4. **赢得选举**：
   - 若候选人在选举超时前收到大多数节点（超过半数）的投票，则成为领导者。
   - 成为领导者后，开始发送心跳消息给其他追随者以维持领导地位。
   - 若未收到足够多的投票，或者在接受到新的领导者心跳前，候选人会重置选举超时，重新进行选举。

